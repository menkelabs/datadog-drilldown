@startuml Dice_Ingestion_Sequence
!theme plain

title Dice Alert Ingestion Sequence

participant "Datadog\nMonitor" as monitor
participant "DICE API\n(dice-server)" as dice_api
participant "KnowledgeService" as knowledge
participant "PropositionStore" as store
participant "RCA Agent\n(embabel-dice-rca)" as rca

== Alert Trigger ==
monitor -> dice_api: POST /api/v1/contexts/default/ingest\n{\n  documentId: "alert-123",\n  text: "High error rate..."\n}

dice_api -> knowledge: processAndStore()
knowledge -> knowledge: Extract Propositions (LLM)
knowledge -> store: save(Propositions)
store --> knowledge: OK

== Analysis Trigger ==
dice_api -> rca: POST /api/v1/analyze (Trigger)
rca -> rca: Collect Datadog Evidence
rca -> rca: Identify Root Causes
rca -> dice_api: POST /api/v1/contexts/incident-1/ingest (Report)
dice_api -> knowledge: processAndStore(Report)
knowledge -> store: update memory
@enduml
