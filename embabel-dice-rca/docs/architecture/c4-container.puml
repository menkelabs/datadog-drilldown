@startuml C4_Container
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

LAYOUT_WITH_LEGEND()

title Container Diagram - Embabel Dice RCA

Person(sre, "SRE / On-Call Engineer", "Investigates incidents")

System_Boundary(rcaAgentSys, "RCA Agent System") {
    Container(shell, "Agent Shell", "Kotlin / Spring Boot", "Interactive CLI")
    Container(agent, "RCA Agent", "Embabel", "AI orchestrator")
    Container(tools, "Datadog MCP Tools", "Kotlin", "@LlmTool bridge")
    Container(engine, "Analysis Engine", "Kotlin", "Log clustering & scoring")
    Container(client, "Datadog Client", "Kotlin", "REST API Client")
}

System_Boundary(diceServerSys, "DICE Server System") {
    Container(diceApi, "DICE API", "Spring Boot", "REST Interface")
    Container(knowledge, "Knowledge Service", "Kotlin", "LLM Proposition extraction")
    Container(reasoning, "Reasoning Service", "Kotlin", "LLM semantic reasoning")
    ContainerDb(storage, "Fact Store", "H2 / Memory", "Incident propositions")
}

System_Ext(datadog, "Datadog", "Observability Platform")
System_Ext(llm, "LLM", "AI Provider")
System_Ext(alerting, "Alerts", "PagerDuty / DD")

Rel(sre, shell, "Describes incident", "CLI")
Rel(shell, agent, "Invokes", "")

Rel(agent, tools, "Calls tools", "")
Rel(agent, llm, "Prompts", "API")
Rel(agent, engine, "Analyzes", "")
Rel(agent, diceApi, "Pushes Report", "REST")

Rel(tools, client, "Calls", "")
Rel(client, datadog, "Queries", "REST")

Rel(alerting, diceApi, "Sends alerts", "Webhook")
Rel(diceApi, agent, "Triggers", "REST")
Rel(knowledge, llm, "Extracts", "API")
Rel(knowledge, storage, "Saves facts", "")
Rel(reasoning, storage, "Reads facts", "")
Rel(reasoning, llm, "Reasons", "API")

@enduml
