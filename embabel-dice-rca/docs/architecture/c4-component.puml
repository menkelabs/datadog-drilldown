@startuml C4_Component
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

LAYOUT_WITH_LEGEND()

title Component Diagram - Embabel Dice RCA Agent

Container_Boundary(agentBoundary, "RCA Agent") {
    Component(agent, "RcaAgent", "Service", "Main orchestrator")
    Component(categorize, "categorize", "Action", "Classify incident")
    Component(parse, "parse", "Action", "Extract scope")
    Component(collect, "collect", "Action", "Gather evidence")
    Component(analyze, "analyze", "Action", "Identify causes")
    Component(report, "report", "Action", "Generate output")
}

Container_Boundary(toolsBoundary, "MCP Tools") {
    Component(logTool, "search_logs", "@LlmTool", "")
    Component(metricTool, "query_metrics", "@LlmTool", "")
    Component(traceTool, "search_traces", "@LlmTool", "")
}

Container_Boundary(engineBoundary, "Engine") {
    Component(logAna, "LogAnalyzer", "Service", "Clustering")
    Component(metricAna, "MetricAnalyzer", "Service", "Anomalies")
    Component(scoring, "ScoringEngine", "Service", "Ranking")
}

Container_Boundary(clientBoundary, "Client") {
    Component(ddInt, "DatadogClient", "Interface", "")
    Component(ddReal, "RealHttpDatadogClient", "Implementation", "")
    Component(ddMock, "MockDatadogClient", "Mock", "")
}

Container_Boundary(bridgeBoundary, "DICE Bridge") {
    Component(diceCli, "DiceClient", "REST", "")
    Component(diceSvc, "DiceIngestionService", "Service", "")
}

Rel(agent, collect, "Uses")
Rel(collect, logTool, "Calls")
Rel(logTool, ddInt, "Uses")
Rel(ddInt, ddReal, "Impl")
Rel(ddInt, ddMock, "Impl")

Rel(agent, analyze, "Uses")
Rel(analyze, scoring, "Calls")
Rel(agent, diceCli, "Pushes")

@enduml
